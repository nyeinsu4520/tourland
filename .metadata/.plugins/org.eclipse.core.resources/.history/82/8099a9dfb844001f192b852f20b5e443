<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Trip Package Details</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <style>
        .image-container img {
            max-width: 100%;
            height: auto;
        }
          .member-image {
            max-width: 50px;
            border-radius: 50%;
            margin-right: 10px;
        }
    </style>
    <script>
        function updateParticipants() {
            var participants = document.getElementById("participantsInput").value;
            document.getElementById("participantsDisplay").innerText = participants;
        }

        function updateRoomTypes() {
            var hotelSelect = document.getElementById("hotelSelect");
            var selectedHotelId = hotelSelect.value;
            var roomTypeSelect = document.getElementById("roomtypeSelect");

            // Hide all room type options initially
            var options = roomTypeSelect.querySelectorAll("option[data-hotel-id]");
            options.forEach(function(option) {
                option.style.display = "none";
            });

            // Show only the options that belong to the selected hotel
            var hotelOptions = roomTypeSelect.querySelectorAll("option[data-hotel-id='" + selectedHotelId + "']");
            hotelOptions.forEach(function(option) {
                option.style.display = "block";
            });
        }
    </script>
</head>
<body>
<div th:replace="@{Fragment/header}"></div>
    <div class="container">
        <h1 th:text="${tripPackage.name}">Trip Package Name</h1>
        <div class="image-container mb-3">
            <img th:src="@{|/uploads/trippackages/${tripPackage.id}/${tripPackage.image}|}" alt="Trip Package Image" class="img-fluid"/>
        </div>
        <p th:text="${tripPackage.description}">Trip Package Description</p>
        <div class="mt-4">
                    <h4 class="fw-bold">About this activity</h4>
                    <div class="mt-3">
                        <i class="fa-solid fa-calendar-check me-2"></i>
                        <span class="fw-bold">Free Cancellation</span>
                        <p class="text-muted" style="font-size:14px;">Cancel up to 24 hours in advance for a full refund</p>
                    </div>
                    <div class="mt-3">
                        <i class="fa-solid fa-user-clock me-2"></i>
                        <span class="fw-bold">Reserve now</span>
                        <p class="text-muted" style="font-size:14px;">Keep your travel plans flexible â€” book your spot and pay nothing today.</p>
                    </div>
                    <div class="mt-3">
                        <i class="fa-solid fa-user-check me-2"></i>
                        <span class="fw-bold">Driver</span>
                        <p class="text-muted" style="font-size:14px;">English</p>
                    </div>
                    <div class="mt-3">
                        <i class="fa-solid fa-user-group me-2"></i>
                        <span class="fw-bold">Private Group</span>
                        <p class="text-muted" style="font-size:14px;">Customized Journey</p>
                    </div>
                    <div class="mt-3">
                        <i class="fa-solid fa-bus me-2"></i>
                        <span class="fw-bold">Pickup included</span>
                        <p class="text-muted" style="font-size:14px;">You will be collected from your accommodation.</p>
                    </div>
                </div>
        
        
        <p>Start Date: <span th:text="${tripPackage.startDate}"></span></p>
        <p>End Date: <span th:text="${tripPackage.endDate}"></span></p>
        <p>Price: <span th:text="${tripPackage.price}"></span></p>

        <form th:action="@{/trippackages/book}" method="post">
        
            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <input type="hidden" name="tripPackageId" th:value="${tripPackage.id}" />
            <div class="form-group">
                <label for="phone">Phone *</label>
                <input type="text" class="form-control" id="phone" name="phone" required>
            </div>
            <div class="form-group">
                <label for="hotelSelect">Select Hotel:</label>
                <select name="hotelId" id="hotelSelect" class="form-control" required onchange="updateRoomTypes()">
                    <option value="" disabled selected>Select a hotel</option>
                    <option th:each="hotel : ${tripPackage.hotels}" th:value="${hotel.hotel_id}" th:text="${hotel.title}"></option>
                </select>
            </div>
            
           <div>
                <label for="roomtypeSelect">Select Room Type:</label>
                <select name="roomtypeId" id="roomtypeSelect" class="form-control" required>
                    <option value="" disabled selected>Select a room Type</option>
                    <!-- First loop over hotels -->
                    <th:block th:each="hotel : ${tripPackage.hotels}">
                        <!-- Nested loop over room types within each hotel -->
                        <option th:each="roomType : ${hotel.roomTypes}"
                                th:if="${roomType.type == 'Single' or roomType.type == 'Double' or roomType.type == 'Suite'}"
                                th:value="${roomType.id}"
                                th:text="${roomType.type}"
                                th:attr="data-hotel-id=${hotel.hotel_id}"></option>
                    </th:block>
                </select>
            </div>

            <div class="form-group">
                <label for="restaurantSelect">Select Restaurant:</label>
                <select name="restaurantId" id="restaurantSelect" class="form-control" required>
                    <option value="" disabled selected>Select a restaurant</option>
                    <option th:each="restaurant : ${tripPackage.restaurants}" th:value="${restaurant.restaurant_id}" th:text="${restaurant.title}"></option>
                </select>
            </div>

            <div class="form-group">
                <label for="participantsInput">Participants:</label>
                <input type="number" id="participantsInput" name="participants" th:value="${participants}" min="1" required class="form-control" oninput="updateParticipants()">
            </div>

            <button type="submit" class="btn btn-primary">Book Now</button>
        </form>
    </div>
    
     <!-- Reviews Section -->
    <div class="container mt-5">
        <h1>Trip Package Review</h1>
        <div th:if="${tripPackage != null}">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title" th:text="${tripPackage.name}">Package Name</h2>
                    <p class="card-text"><strong>Location:</strong> <span th:text="${tripPackage.location}">Location</span></p>
                    <p class="card-text"><strong>Description:</strong> <span th:text="${tripPackage.description}">Description</span></p>
                </div>
            </div>

            <div class="container mt-4">
    <h3>Reviews</h3>
    <ul class="list-group">
        <li th:each="review : ${reviews}" class="list-group-item mb-3">
            <div class="row">
                <div class="col-md-4 member-details">
                    <div class="member-image">
                        <img class="img-fluid rounded"
                             th:if="${review.member.imageUrl != null}"
                             th:src="@{|/uploads/members/${review.member.id}/${review.member.imageUrl}|}"
                             alt="Member Image"/>
                        <img th:unless="${review.member.imageUrl != null}" src="/image/img/user.png" alt="Default Image"/>
                    </div>
                    <h5 class="card-title mt-3"><strong>Member:</strong> <span th:text="${review.member.name}">No member</span></h5>
                </div>
                <div class="col-md-8 review-details">
                    <textarea class="form-control" rows="3" readonly th:text="${review.comment}">No comment</textarea>
                    <p class="card-text mt-3"><strong>Rating:</strong> <span th:text="${review.rating}">No rating</span></p>
                </div>
            </div>
        </li>
    </ul>
</div>

<div class="mt-4">
    <h3>Add Review</h3>
    <form th:object="${review}" th:action="@{/trippackage/{id}/reviews(id=${tripPackage.id})}" method="post">
        <div class="mb-3">
            <label for="comment" class="form-label">Comment:</label>
            <textarea class="form-control" id="comment" name="comment" rows="3" required th:field="*{comment}"></textarea>
        </div>
        <div class="mb-3">
            <label for="rating" class="form-label">Rating:</label>
            <input type="number" class="form-control" id="rating" name="rating" min="1" max="5" required th:field="*{rating}">
        </div>
        <button type="submit" class="btn btn-primary">Submit Review</button>
    </form>
</div>

    
	<div th:replace="@{Fragment/footer}"></div>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</body>
</html>
