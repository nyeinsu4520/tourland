<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
     <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <script src="/bootstrap/js/bootstrap.bundle.js" type="text/javascript"></script>
    <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
    
    <script th:inline="javascript">
        /*<![CDATA[*/
        function disableButton(form) {
            var button = form.querySelector('button[type="submit"]');
            button.disabled = true;
        }
        /*]]>*/
    </script>
    
    <style>
        .btn[disabled] {
            opacity: 0.65; /* Adjust opacity for disabled buttons */
            cursor: not-allowed; /* Change cursor to indicate button is disabled */
        }
        .container-fluid {
            display: flex;
            flex-wrap: nowrap;
            height: 100vh;
        }
        .sidebar {
            flex-shrink: 0;
        }
        .content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
        }
    </style>
</head>
<body>

    <div th:replace="@{Fragment/header}"></div>
    <div class="container-fluid">
    
         <div th:replace="@{Fragment/dashboard}"></div>

        <!-- Content Area -->
        <div class="content">
            <h1>Admin Dashboard</h1>
            
            <!-- Booking Table -->
            <h2>Bookings</h2>
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th>Booking ID</th>
                            <th>Member Name</th>
                            <th>Package ID</th>
                            <th>Package Title</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Country</th>
                            <th>Phone</th>
                            <th>Selected Date</th>
                            <th>Selected Passengers</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="booking : ${bookings}">
                            <td th:text="${booking.booking_id}"></td>
                            <td th:text="${booking.member != null ? booking.member.name : 'N/A'}"></td>
                            <td th:text="${booking.pkg != null ? booking.pkg.package_id : 'N/A'}"></td>
                            <td th:text="${booking.pkg != null ? booking.pkg.title : 'N/A'}"></td>
                            <td th:text="${booking.name}"></td>
                            <td th:text="${booking.email}"></td>
                            <td th:text="${booking.country}"></td>
                            <td th:text="${booking.phone}"></td>
                            <td th:text="${booking.selectedDate}"></td>
                            <td th:text="${booking.selectedPassengers}"></td>
                            <td th:text="${booking.status.name()}">
                                <span th:if="${booking.status.name() == 'CONFIRMED'}" class="text-success">Confirmed</span>
                                <span th:if="${booking.status.name() == 'REJECTED'}" class="text-danger">Rejected</span>
                                <span th:if="${booking.status.name() == 'PENDING'}" class="text-warning">Pending</span>
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <form th:action="@{/admin/bookings/{bookingId}/confirm(bookingId=${booking.booking_id})}" method="post" onsubmit="disableButton(this)">
                                        <button type="submit" id="confirm-${booking.booking_id}" class="btn btn-success btn-sm"
                                                th:disabled="${booking.status.name() == 'CONFIRMED' or booking.status.name() == 'REJECTED'}">Confirm</button>
                                    </form>
                                    <form th:action="@{/admin/bookings/{bookingId}/reject(bookingId=${booking.booking_id})}" method="post" onsubmit="disableButton(this)">
                                        <button type="submit" id="reject-${booking.booking_id}" class="btn btn-danger btn-sm"
                                                th:disabled="${booking.status.name() == 'CONFIRMED' or booking.status.name() == 'REJECTED'}">Reject</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Trip Package Bookings Table -->
            <h2>Trip Package Bookings</h2>
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th>Booking ID</th>
                            <th>Member Name</th>
                            <th>TripPackage ID</th>
                            <th>TripPackage Title</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Selected Date</th>
                            <th>Selected Passengers</th>
                            <th>Selected Hotel</th>
                            <th>Selected Restaurant</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="tripPackageBooking : ${tripPackageBookings}">
                            <td th:text="${tripPackageBooking.id}"></td>
                            <td th:text="${tripPackageBooking.member != null ? tripPackageBooking.member.name : 'N/A'}"></td>
                            <td th:text="${tripPackageBooking.tripPackage != null ? tripPackageBooking.tripPackage.id : 'N/A'}"></td>
                            <td th:text="${tripPackageBooking.tripPackage != null ? tripPackageBooking.tripPackage.description : 'N/A'}"></td>
                            <td th:text="${tripPackageBooking.email}"></td>
                            <td th:text="${tripPackageBooking.phone}"></td>
                            <td th:text="${tripPackageBooking.bookingDate}"></td>
                            <td th:text="${tripPackageBooking.participants}"></td>
                            <td th:text="${tripPackageBooking.hotel.title}"></td>
                            <td th:text="${tripPackageBooking.restaurant.title}"></td>
                            <td th:text="${tripPackageBooking.status != null ? tripPackageBooking.status.name() : 'N/A'}">
                                <span th:if="${tripPackageBooking.status != null and tripPackageBooking.status.name() == 'CONFIRMED'}" class="text-success">Confirmed</span>
                                <span th:if="${tripPackageBooking.status != null and tripPackageBooking.status.name() == 'REJECTED'}" class="text-danger">Rejected</span>
                                <span th:if="${tripPackageBooking.status != null and tripPackageBooking.status.name() == 'PENDING'}" class="text-warning">Pending</span>
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <form th:action="@{/admin/trip-package-bookings/{tripPackagebookingId}/confirm(tripPackagebookingId=${tripPackageBooking.id})}" method="post" onsubmit="disableButton(this)">
                                        <button type="submit" class="btn btn-success btn-sm" th:disabled="${tripPackageBooking.status.name() == 'CONFIRMED' or tripPackageBooking.status.name() == 'REJECTED'}">Confirm</button>
                                    </form>
                                    <form th:action="@{/admin/trip-package-bookings/{tripPackagebookingId}/reject(tripPackagebookingId=${tripPackageBooking.id})}" method="post" onsubmit="disableButton(this)">
                                        <button type="submit" class="btn btn-danger btn-sm" th:disabled="${tripPackageBooking.status.name() == 'CONFIRMED' or tripPackageBooking.status.name() == 'REJECTED'}">Reject</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- End Content Area -->
        
    </div>
    <div th:replace="@{Fragment/footer}"></div>
</body>
</html>
